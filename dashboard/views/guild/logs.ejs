<%- include('../layout', { title: 'Logs - ' + guild.name, body: `
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h3 mb-1">
            <i class="fas fa-clipboard-list me-2"></i>
            Registro de Eventos
        </h1>
        <p class="text-muted mb-0">${guild.name}</p>
    </div>
    <a href="/guild/${guild.id}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left me-2"></i>Volver
    </a>
</div>

<div class="row mb-3">
    <div class="col-md-6">
        <div class="input-group">
            <span class="input-group-text"><i class="fas fa-search"></i></span>
            <input type="text" id="logSearch" class="form-control" placeholder="Buscar en logs...">
        </div>
    </div>
    <div class="col-md-6 text-end">
        <button class="btn btn-sm btn-primary" onclick="loadLogs()">
            <i class="fas fa-sync-alt me-1"></i>Actualizar
        </button>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-history me-2"></i>
                    Historial de Actividad
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Tipo</th>
                                <th>Usuario</th>
                                <th>Fecha</th>
                                <th>Detalles</th>
                            </tr>
                        </thead>
                        <tbody id="logsTable">
                            <tr>
                                <td colspan="4" class="text-center">
                                    <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                                    Cargando logs...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
`, script: `
<script>
    const guildId = '${guild.id}';

    async function loadLogs() {
        const tbody = document.getElementById('logsTable');
        try {
            const res = await fetch('/api/guild/' + guildId + '/logs');
            if (!res.ok) throw new Error('Error HTTP ' + res.status);
            const logs = await res.json();

            if (!logs || logs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center">No hay logs disponibles</td></tr>';
                return;
            }

            tbody.innerHTML = logs.map(log => {
                const date = new Date(log.timestamp).toLocaleString();
                const type = log.type || 'evento';
                const user = log.user || 'Desconocido';
                const details = log.details || '';

                return (
                    '<tr>' +
                        '<td><span class="badge bg-secondary text-uppercase">' + type + '</span></td>' +
                        '<td>' + user + '</td>' +
                        '<td>' + date + '</td>' +
                        '<td>' + details + '</td>' +
                    '</tr>'
                );
            }).join('');

            // Filtro de bÃºsqueda
            const searchInput = document.getElementById('logSearch');
            if (searchInput && !searchInput._listenerAttached) {
                searchInput._listenerAttached = true;
                searchInput.addEventListener('input', function () {
                    const q = this.value.toLowerCase();
                    Array.from(tbody.querySelectorAll('tr')).forEach(tr => {
                        const text = tr.textContent.toLowerCase();
                        tr.style.display = text.includes(q) ? '' : 'none';
                    });
                });
            }
        } catch (error) {
            console.error('Error cargando logs:', error);
            tbody.innerHTML = '<tr><td colspan="4" class="text-center text-danger">Error cargando logs</td></tr>';
        }
    }

    document.addEventListener('DOMContentLoaded', loadLogs);
</script>
` }) %>
